<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div class="container-fluid">
        <div class="row">
            <div>
                <form th:action="@{/image/upload}" method="post" id="img-form" enctype="multipart/form-data">
                    <div class="my-3  d-flex justify-content-center align-content-center">
                        <div style="position: relative; width: 12rem; height: 12rem;" id = "image_container">
                            <img id = "user_img" th:src="${img}==null ? '/img/noneuser.png' : '/files/'+${img.name}" onerror="readURL(this);"
                                 class="shadow rounded-circle text-center"
                                 style="position: absolute; top: 0; left: 0; transform: translate(50,50); width: 100%; height: 100%; object-fit: cover; margin: auto">
                        </div>
                    </div>

                    <div class="my-3 mt-5 d-flex justify-item-center align-items-center justify-content-center align-content-center">
                        <input type="file" class="visually-hidden" id="img-input" name="img-input" onchange="imageUploading();">
                        <button type="button" id="img-upload-btn" class="btn btn-primary mx-3 w-25">이미지 업로드</button>
                    </div>

                    <div class="my-3 d-flex justify-item-center align-items-center justify-content-center align-content-center">
                        <a href="/member/pw_modify" class="btn btn-primary mx-3 w-25">비밀번호 변경하기</a>
                    </div>

                    <div class="my-3 d-flex justify-item-center align-items-center justify-content-center align-content-center">
                        <a href="/member/mypage_question" class="btn btn-primary mx-3 w-25">내가 쓴 글</a>
                    </div>

                    <div class="my-3 d-flex justify-item-center align-items-center justify-content-center align-content-center">
                        <a href="/member/mypage_answer" class="btn btn-primary mx-3 w-25">내가 쓴 답변</a>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
<script layout:fragment="script" type='text/javascript'>

    const img_btn = document.getElementById("img-upload-btn");
    img_btn.addEventListener('click', function () {
        document.getElementById('img-input').click();
    });


    function readURL(input)
    {
        if(input.files && input.files[0])
        {
            const reader = new FileReader();
            reader.addEventListener('load',function (e)
            {
                debugger;
                const str = e.target.result.toString();

                var img = document.getElementById('user_img');
                img.setAttribute('src', str);
            });
            reader.readAsDataURL(input.files[0]);
        }
        document.getElementById('img-form').submit();
    }

    function imageUploading()
    {
        const btn = document.getElementById('img-upload-btn');
        btn.setAttribute('class','btn btn-danger mx-3 w-25');
        setTimeout(() => console.log("after"), 10000);
        document.getElementById('img-form').submit();
    }

    // const img_upload = document.getElementById("img-input");
    // img_upload.addEventListener('change', function (){
    //     //document.getElementById('img-form').submit();
    //     var reader = new FileReader();
    //
    //     reader.onload = function (e)
    //     {
    //         var img = document.createElement("img");
    //         img.setAttribute("src", e.target.result.toString());
    //         document.querySelector("div#image_container").appendChild(img);
    //     }
    //
    // });


</script>
</html>